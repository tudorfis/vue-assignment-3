import linkEEhelper from './linkEE.helper'
import { LinkDrawHelper } from './linkDraw.helper'
import { gridModel } from '../grid.model'

const cells1 = {"1-3":{"is":1,"type":"SEND_EMAIL","id":4},"2-1":{"is":1,"type":"SEND_SMS","id":8},"2-4":{"is":1,"type":"ADD_REMOVE_TAG","id":9},"3-2":{"is":1,"type":"AUTOMATION","id":0},"4-2":{"is":1,"type":"WAIT","id":15}}
const links1 = ["1-3__3-2","2-1__2-4","2-1__1-3","3-2__2-4","4-2__2-1","2-1__4-2","1-3__2-1","1-3__2-4"]
const eePathMap1 = {"1-2":{"h":1,"v":0,"c":1,"linkKey":"1-3__3-2"},"2-2":{"h":2,"v":1,"c":1,"linkKey":"2-1__4-2"},"2-3":{"h":1,"v":0,"c":1,"linkKey":"2-1__1-3"},"3-3":{"h":1,"v":0,"c":0,"linkKey":""},"3-4":{"h":0,"v":0,"c":1,"linkKey":"3-2__2-4"},"4-1":{"h":0,"v":0,"c":1,"linkKey":"4-2__2-1"},"3-1":{"h":0,"v":1,"c":0,"linkKey":""},"3-2":{"h":0,"v":1,"c":0,"linkKey":""},"1-1":{"h":0,"v":0,"c":1,"linkKey":"1-3__2-1"},"1-4":{"h":0,"v":0,"c":1,"linkKey":"1-3__2-4"}}
const eeMap1 = {"1-3":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{"2-1":1},"total":1},"right":{"out":{"2-4":1},"in":{},"total":1},"left":{"out":{"3-2":1,"2-1":2},"in":{},"total":2}},"3-2":{"up":{"out":{},"in":{"1-3":1},"total":1},"down":{"out":{},"in":{},"total":0},"right":{"out":{"2-4":1},"in":{},"total":1},"left":{"out":{},"in":{},"total":0}},"2-1":{"up":{"out":{},"in":{"1-3":1},"total":1},"down":{"out":{},"in":{"4-2":1},"total":1},"right":{"out":{"2-4":1,"1-3":2,"4-2":3},"in":{},"total":3},"left":{"out":{},"in":{},"total":0}},"2-4":{"up":{"out":{},"in":{"1-3":1},"total":1},"down":{"out":{},"in":{"3-2":1},"total":1},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{"2-1":1},"total":1}},"4-2":{"up":{"out":{},"in":{"2-1":2},"total":2},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{},"total":0},"left":{"out":{"2-1":1},"in":{},"total":1}}}

const cells2 = {"1-3":{"is":1,"type":"SEND_EMAIL","id":4},"2-1":{"is":1,"type":"SEND_SMS","id":8},"2-4":{"is":1,"type":"ADD_REMOVE_TAG","id":9},"3-1":{"is":1,"type":"ADD_REMOVE_TAG","id":6},"3-2":{"is":1,"type":"AUTOMATION","id":0},"3-3":{"is":1,"type":"SUBSCRIBE_LIST","id":29},"4-2":{"is":1,"type":"WAIT","id":15},"5-3":{"is":1,"type":"AUTOMATION","id":66}}
const links2 = ["1-3__3-2","2-1__2-4","2-1__1-3","3-2__2-4","4-2__2-1","2-1__4-2","1-3__2-1","1-3__2-4","3-3__5-3","2-4__5-3","1-3__5-3","2-1__5-3","3-2__5-3","4-2__5-3","3-1__5-3","5-3__3-3"]
const eePathMap2 = {"1-2":{"h":1,"v":0,"c":1,"linkKey":"1-3__3-2"},"2-2":{"h":3,"v":1,"c":1,"linkKey":"2-1__4-2"},"2-3":{"h":1,"v":1,"c":3,"linkKey":"2-1__1-3"},"3-3":{"h":1,"v":3,"c":0,"linkKey":""},"3-4":{"h":0,"v":0,"c":1,"linkKey":"3-2__2-4"},"4-1":{"h":0,"v":1,"c":1,"linkKey":"4-2__2-1"},"3-1":{"h":0,"v":1,"c":0,"linkKey":""},"3-2":{"h":0,"v":1,"c":0,"linkKey":""},"1-1":{"h":0,"v":0,"c":1,"linkKey":"1-3__2-1"},"1-4":{"h":0,"v":0,"c":1,"linkKey":"1-3__2-4"},"4-3":{"h":0,"v":5,"c":1,"linkKey":"4-2__5-3"},"4-2":{"h":0,"v":1,"c":0,"linkKey":""},"5-2":{"h":1,"v":0,"c":1,"linkKey":"3-2__5-3"},"5-1":{"h":0,"v":0,"c":1,"linkKey":"3-1__5-3"}}
const eeMap2 = {"1-3":{"up":{"out":{},"in":{},"total":0},"down":{"out":{"5-3":2},"in":{"2-1":1},"total":2},"right":{"out":{"2-4":1},"in":{},"total":1},"left":{"out":{"3-2":1,"2-1":2},"in":{},"total":2}},"3-2":{"up":{"out":{},"in":{"1-3":1},"total":1},"down":{"out":{"5-3":1},"in":{},"total":1},"right":{"out":{"2-4":1},"in":{},"total":1},"left":{"out":{},"in":{},"total":0}},"2-1":{"up":{"out":{},"in":{"1-3":1},"total":1},"down":{"out":{},"in":{"4-2":1},"total":1},"right":{"out":{"2-4":1,"1-3":2,"4-2":3,"5-3":4},"in":{},"total":4},"left":{"out":{},"in":{},"total":0}},"2-4":{"up":{"out":{},"in":{"1-3":1},"total":1},"down":{"out":{},"in":{"3-2":1},"total":1},"right":{"out":{},"in":{},"total":0},"left":{"out":{"5-3":2},"in":{"2-1":1},"total":2}},"4-2":{"up":{"out":{},"in":{"2-1":2},"total":2},"down":{"out":{},"in":{},"total":0},"right":{"out":{"5-3":1},"in":{},"total":1},"left":{"out":{"2-1":1},"in":{},"total":1}},"3-3":{"up":{"out":{},"in":{},"total":0},"down":{"out":{"5-3":1},"in":{"5-3":2},"total":2},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{},"total":0}},"5-3":{"up":{"out":{"3-3":6},"in":{"3-3":1,"2-4":2,"1-3":3,"2-1":4,"4-2":5},"total":6},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{"3-2":1,"3-1":2},"total":2}},"3-1":{"up":{"out":{},"in":{},"total":0},"down":{"out":{"5-3":2},"in":{},"total":2},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{},"total":0}}}

const cells3 = {"1-2":{"is":1,"type":"SEND_SMS","id":97},"1-3":{"is":1,"type":"WAIT","id":90},"1-4":{"is":1,"type":"SPLIT","id":37},"1-6":{"is":1,"type":"GO_TO","id":14},"1-7":{"is":1,"type":"ADD_REMOVE_TAG","id":10},"2-5":{"is":1,"type":"SEND_EMAIL","id":31},"3-1":{"is":1,"type":"SEND_SMS","id":8},"3-4":{"is":1,"type":"ADD_REMOVE_TAG","id":6},"3-5":{"is":1,"type":"SUBSCRIBE_SEQUENCE","id":45},"3-10":{"is":1,"type":"AUTOMATION","id":66},"4-3":{"is":1,"type":"AUTOMATION","id":64},"4-6":{"is":1,"type":"SUBSCRIBE_LIST","id":29},"5-2":{"is":1,"type":"WAIT","id":15},"5-5":{"is":1,"type":"SUBSCRIBE_LIST","id":24},"6-1":{"is":1,"type":"SPLIT","id":86},"6-2":{"is":1,"type":"SUBSCRIBE_SEQUENCE","id":46},"6-5":{"is":1,"type":"GO_TO","id":43},"6-9":{"is":1,"type":"ADD_REMOVE_TAG","id":9},"7-1":{"is":1,"type":"SEND_SMS","id":46},"7-3":{"is":1,"type":"SEND_EMAIL","id":66},"7-8":{"is":1,"type":"SPLIT","id":88},"8-2":{"is":1,"type":"SEND_SMS","id":12},"8-4":{"is":1,"type":"GO_TO","id":46},"8-5":{"is":1,"type":"SPLIT","id":74},"8-6":{"is":1,"type":"ADD_REMOVE_TAG","id":101},"9-5":{"is":1,"type":"SUBSCRIBE_SEQUENCE","id":87},"9-8":{"is":1,"type":"SEND_EMAIL","id":4}}
const links3 = ["9-8__4-3","3-1__6-9","3-1__9-8","4-3__6-9","5-2__3-1","3-1__6-9","3-1__5-2","9-8__3-1","9-8__6-9","4-6__3-10","6-9__3-10","9-8__3-10","3-1__3-10","4-3__3-10","5-2__3-10","3-4__3-10","3-10__4-6","6-1__6-2","7-8__7-3","8-2__8-4","8-5__6-5","8-5__9-5","8-5__8-6","8-5__8-4","6-5__8-5","6-5__7-3","6-2__7-8","6-2__7-1","6-1__8-2","5-5__3-5","1-4__1-7","1-4__1-6","1-2__1-3","3-5__2-5","2-5__1-2","1-3__1-4"]
const eePathMap3 = {"9-7":{"h":2,"v":0,"c":0,"linkKey":""},"9-6":{"h":2,"v":0,"c":0,"linkKey":""},"9-5":{"h":2,"v":0,"c":0,"linkKey":""},"9-4":{"h":2,"v":0,"c":0,"linkKey":""},"9-3":{"h":1,"v":0,"c":1,"linkKey":"9-8__4-3"},"8-3":{"h":1,"v":1,"c":0,"linkKey":""},"7-3":{"h":0,"v":1,"c":0,"linkKey":""},"6-3":{"h":1,"v":1,"c":1,"linkKey":"6-5__7-3"},"5-3":{"h":1,"v":1,"c":0,"linkKey":""},"3-2":{"h":4,"v":0,"c":1,"linkKey":"3-1__5-2"},"3-3":{"h":4,"v":0,"c":0,"linkKey":""},"3-4":{"h":4,"v":0,"c":0,"linkKey":""},"3-5":{"h":5,"v":0,"c":0,"linkKey":""},"3-6":{"h":5,"v":0,"c":1,"linkKey":"3-10__4-6"},"3-7":{"h":6,"v":0,"c":0,"linkKey":""},"3-8":{"h":5,"v":0,"c":1,"linkKey":"3-1__9-8"},"3-9":{"h":3,"v":0,"c":2,"linkKey":"3-1__6-9"},"4-9":{"h":2,"v":2,"c":1,"linkKey":"4-3__6-9"},"5-9":{"h":1,"v":3,"c":0,"linkKey":""},"4-8":{"h":3,"v":1,"c":0,"linkKey":""},"5-8":{"h":1,"v":1,"c":0,"linkKey":""},"6-8":{"h":0,"v":1,"c":1,"linkKey":"6-2__7-8"},"7-8":{"h":0,"v":1,"c":0,"linkKey":""},"8-8":{"h":0,"v":1,"c":0,"linkKey":""},"4-4":{"h":2,"v":0,"c":0,"linkKey":""},"4-5":{"h":2,"v":1,"c":0,"linkKey":""},"4-6":{"h":2,"v":0,"c":0,"linkKey":""},"4-7":{"h":3,"v":0,"c":0,"linkKey":""},"5-1":{"h":0,"v":1,"c":1,"linkKey":"5-2__3-1"},"4-1":{"h":0,"v":2,"c":0,"linkKey":""},"4-2":{"h":0,"v":1,"c":0,"linkKey":""},"9-2":{"h":1,"v":0,"c":0,"linkKey":""},"9-1":{"h":0,"v":0,"c":1,"linkKey":"9-8__3-1"},"8-1":{"h":0,"v":1,"c":1,"linkKey":"6-1__8-2"},"7-1":{"h":0,"v":2,"c":0,"linkKey":""},"6-1":{"h":0,"v":1,"c":0,"linkKey":""},"9-9":{"h":1,"v":0,"c":1,"linkKey":"9-8__6-9"},"8-9":{"h":0,"v":1,"c":0,"linkKey":""},"7-9":{"h":0,"v":1,"c":0,"linkKey":""},"4-10":{"h":0,"v":3,"c":2,"linkKey":"4-6__3-10"},"6-10":{"h":0,"v":1,"c":1,"linkKey":"6-9__3-10"},"5-10":{"h":0,"v":2,"c":1,"linkKey":"5-2__3-10"},"9-10":{"h":0,"v":0,"c":1,"linkKey":"9-8__3-10"},"8-10":{"h":0,"v":1,"c":0,"linkKey":""},"7-10":{"h":0,"v":1,"c":0,"linkKey":""},"5-4":{"h":1,"v":0,"c":0,"linkKey":""},"5-5":{"h":1,"v":0,"c":0,"linkKey":""},"5-6":{"h":1,"v":0,"c":0,"linkKey":""},"5-7":{"h":1,"v":0,"c":0,"linkKey":""},"7-7":{"h":1,"v":0,"c":0,"linkKey":""},"7-6":{"h":1,"v":0,"c":0,"linkKey":""},"7-5":{"h":1,"v":2,"c":0,"linkKey":""},"7-4":{"h":1,"v":0,"c":0,"linkKey":""},"6-4":{"h":2,"v":0,"c":0,"linkKey":""},"6-5":{"h":1,"v":0,"c":0,"linkKey":""},"6-6":{"h":1,"v":0,"c":0,"linkKey":""},"6-7":{"h":1,"v":0,"c":0,"linkKey":""},"7-2":{"h":0,"v":0,"c":1,"linkKey":"6-2__7-1"},"1-5":{"h":2,"v":0,"c":0,"linkKey":""},"1-6":{"h":1,"v":0,"c":0,"linkKey":""},"2-4":{"h":1,"v":0,"c":0,"linkKey":""},"2-3":{"h":1,"v":0,"c":0,"linkKey":""},"2-2":{"h":0,"v":0,"c":1,"linkKey":"2-5__1-2"}}
const eeMap3 = {"9-8":{"up":{"out":{},"in":{"3-1":1},"total":1},"down":{"out":{},"in":{},"total":0},"right":{"out":{"6-9":1,"3-10":2},"in":{},"total":2},"left":{"out":{"4-3":1,"3-1":2},"in":{},"total":2}},"4-3":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{"9-8":1},"total":1},"right":{"out":{"6-9":1,"3-10":3},"in":{},"total":3},"left":{"out":{},"in":{},"total":0}},"3-1":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{"5-2":1,"9-8":2},"total":2},"right":{"out":{"6-9":3,"9-8":2,"5-2":4,"3-10":5},"in":{},"total":5},"left":{"out":{},"in":{},"total":0}},"6-9":{"up":{"out":{},"in":{"3-1":3,"4-3":2},"total":3},"down":{"out":{},"in":{"9-8":1},"total":1},"right":{"out":{"3-10":1},"in":{},"total":1},"left":{"out":{},"in":{},"total":0}},"5-2":{"up":{"out":{},"in":{"3-1":1},"total":1},"down":{"out":{},"in":{},"total":0},"right":{"out":{"3-10":1},"in":{},"total":1},"left":{"out":{"3-1":1},"in":{},"total":1}},"4-6":{"up":{"out":{},"in":{"3-10":1},"total":1},"down":{"out":{},"in":{},"total":0},"right":{"out":{"3-10":2},"in":{},"total":2},"left":{"out":{},"in":{},"total":0}},"3-10":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{"4-6":1,"6-9":2,"9-8":3,"4-3":4,"5-2":5},"total":5},"right":{"out":{},"in":{},"total":0},"left":{"out":{"4-6":3},"in":{"3-1":1,"3-4":2},"total":3}},"3-4":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{"3-10":1},"in":{},"total":1},"left":{"out":{},"in":{},"total":0}},"6-1":{"up":{"out":{},"in":{},"total":0},"down":{"out":{"8-2":2},"in":{},"total":2},"right":{"out":{"6-2":1},"in":{},"total":1},"left":{"out":{},"in":{},"total":0}},"6-2":{"up":{"out":{},"in":{},"total":0},"down":{"out":{"7-1":1},"in":{},"total":1},"right":{"out":{"7-8":1},"in":{},"total":1},"left":{"out":{},"in":{"6-1":1},"total":1}},"7-8":{"up":{"out":{},"in":{"6-2":2},"total":2},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{},"total":0},"left":{"out":{"7-3":1},"in":{},"total":1}},"7-3":{"up":{"out":{},"in":{"6-5":1},"total":1},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{"7-8":1},"total":1},"left":{"out":{},"in":{},"total":0}},"8-2":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{"8-4":1},"in":{},"total":1},"left":{"out":{},"in":{"6-1":1},"total":1}},"8-4":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{"8-5":1},"total":1},"left":{"out":{},"in":{"8-2":1},"total":1}},"8-5":{"up":{"out":{"6-5":1},"in":{"6-5":2},"total":2},"down":{"out":{"9-5":1},"in":{},"total":1},"right":{"out":{"8-6":1},"in":{},"total":1},"left":{"out":{"8-4":1},"in":{},"total":1}},"6-5":{"up":{"out":{},"in":{},"total":0},"down":{"out":{"8-5":2},"in":{"8-5":1},"total":2},"right":{"out":{},"in":{},"total":0},"left":{"out":{"7-3":1},"in":{},"total":1}},"9-5":{"up":{"out":{},"in":{"8-5":1},"total":1},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{},"total":0}},"8-6":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{"8-5":1},"total":1}},"7-1":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{"6-2":1},"total":1},"left":{"out":{},"in":{},"total":0}},"5-5":{"up":{"out":{"3-5":1},"in":{},"total":1},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{},"total":0}},"3-5":{"up":{"out":{"2-5":1},"in":{},"total":1},"down":{"out":{},"in":{"5-5":1},"total":1},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{},"total":0}},"1-4":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{"1-7":1,"1-6":2},"in":{},"total":2},"left":{"out":{},"in":{"1-3":1},"total":1}},"1-7":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{"1-4":1},"total":1}},"1-6":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{},"in":{},"total":0},"left":{"out":{},"in":{"1-4":1},"total":1}},"1-2":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{"2-5":1},"total":1},"right":{"out":{"1-3":1},"in":{},"total":1},"left":{"out":{},"in":{},"total":0}},"1-3":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{},"total":0},"right":{"out":{"1-4":1},"in":{},"total":1},"left":{"out":{},"in":{"1-2":1},"total":1}},"2-5":{"up":{"out":{},"in":{},"total":0},"down":{"out":{},"in":{"3-5":1},"total":1},"right":{"out":{},"in":{},"total":0},"left":{"out":{"1-2":1},"in":{},"total":1}}}

describe('linkEEhelper', function () {
    test('constructor()', function () {
        expect(linkEEhelper.eeMap).toEqual({})
        expect(linkEEhelper.eePathMap).toEqual({})

        expect(linkEEhelper.linkEEblueprint.up).toEqual({ out: {}, in: {}, total: 0 })
        expect(linkEEhelper.linkEEblueprint.down).toEqual({ out: {}, in: {}, total: 0 })
        expect(linkEEhelper.linkEEblueprint.right).toEqual({ out: {}, in: {}, total: 0 })
        expect(linkEEhelper.linkEEblueprint.left).toEqual({ out: {}, in: {}, total: 0 })
    })
    test('genereateEEpath() - 1.1', function() {
        gridModel.model = { cells: cells1, links: links1, }
        linkEEhelper.generateEEpath()
        expect(linkEEhelper.eePathMap).toEqual(eePathMap1)
    })
    test('genereateEEpath() - 1.2', function(){
        gridModel.model = { cells: cells2, links: links2, }
        linkEEhelper.generateEEpath()
        expect(linkEEhelper.eePathMap).toEqual(eePathMap2)
    })
    test('genereateEEpath() - 1.3', function(){
        gridModel.model = { cells: cells3, links: links3, }
        linkEEhelper.generateEEpath()
        expect(linkEEhelper.eePathMap).toEqual(eePathMap3)
    })
    test('generateEEmap() - 1.1', function(){
        gridModel.model = { cells: cells1, links: links1, }
        linkEEhelper.generateEEmap()
        expect(linkEEhelper.eeMap).toEqual(eeMap1)
    })
    test('generateEEmap() - 1.2', function(){
        gridModel.model = { cells: cells2, links: links2, }
        linkEEhelper.generateEEmap()
        expect(linkEEhelper.eeMap).toEqual(eeMap2)
    })
    test('generateEEmap() - 1.3', function(){
        gridModel.model = { cells: cells3, links: links3, }
        linkEEhelper.generateEEmap()
        expect(linkEEhelper.eeMap).toEqual(eeMap3)
    })
})